<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="group_project_manager" model="res.groups">
        <field name="name">Project manager</field>
        <field name="implied_ids" eval="[(4, ref('project.group_project_user'))]"/>
        <field name="category_id" ref="base.module_category_services_project"/>
    </record>

    <record id="group_user_hr_timesheet" model="res.groups">
        <field name="name">HR</field>
        <field name="implied_ids" eval="[(4, ref('hr_timesheet.group_hr_timesheet_approver'))]"/>
        <field name="category_id" ref="base.module_category_services_timesheets"/>
    </record>

    <record id="project_user_rule" model="ir.rule">
        <field name="name">Project user rule</field>
        <field name="model_id" ref="model_project_project"/>
        <field name="groups" eval="[(4, ref('project.group_project_user'))]"/>
        <field name="domain_force">['|','|', ('favorite_user_ids','in',user.id),
            ('manager_follower_ids','in',user.employee_id.id), ('is_internal', '=', True)]
        </field>
    </record>

    <record id="pontusinc_timesheet_rule_global" model="ir.rule">
        <field name="name">Pontusinc timesheet rule global</field>
        <field name="model_id" ref="model_account_analytic_line"/>
        <field eval="True" name="global"/>
        <field name="domain_force">[('project_id.is_internal_project', '!=', True)]</field>
    </record>

    <record id="timesheet_line_rule_approver" model="ir.rule">
        <field name="name">account.analytic.line.timesheet.approver</field>
        <field name="model_id" ref="analytic.model_account_analytic_line"/>
        <field name="domain_force">[
            ('project_id', '!=', False),
            '|', '|',
            ('employee_id.parent_id.user_id', '=', user.id),
            ('employee_id.coach_id.user_id', '=', user.id),
            ('project_id.user_id', '=', user.id)
            ]
        </field>
        <field name="groups" eval="[(4, ref('hr_timesheet.group_hr_timesheet_approver'))]"/>
    </record>

    <record id="timesheet_line_rule_hr_approver" model="ir.rule">
        <field name="name">account.analytic.line.timesheet.hr.approver</field>
        <field name="model_id" ref="analytic.model_account_analytic_line"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('pontusinc_project.group_user_hr_timesheet'))]"/>
    </record>

    <record id="project_task_type_user_rule" model="ir.rule">
        <field name="name">Project task type user rule</field>
        <field name="model_id" ref="model_project_task_type"/>
        <field name="groups" eval="[(4, ref('project.group_project_user'))]"/>
        <field name="domain_force">['|',('group_ids','=',False), ('group_ids','in',user.groups_id.ids)]</field>
    </record>

    <record model="ir.rule" id="project.task_visibility_rule">
        <field name="domain_force">[
            '|',
            '&amp;',
            ('project_id', '!=', False),
            '|','|',
            ('project_id.privacy_visibility', '!=', 'followers'),
            ('project_id.message_partner_ids', 'in', [user.partner_id.id]),
            ('project_id.favorite_user_ids', 'in', [user.id]),
            '|',
            ('message_partner_ids', 'in', [user.partner_id.id]),
            ('user_ids', 'in', [user.id])
            ]
        </field>
    </record>

    <record id="hr_timesheet.timesheet_line_rule_user" model="ir.rule">
        <field name="domain_force">[
            ('user_id', '=', user.id),
            ('project_id', '!=', False),
            '|', '|','|',
            ('project_id.privacy_visibility', '!=', 'followers'),
            ('project_id.message_partner_ids', 'in', [user.partner_id.id]),
            ('project_id.favorite_user_ids', 'in', [user.id]),
            ('task_id.message_partner_ids', 'in', [user.partner_id.id])
            ]
        </field>
    </record>

</odoo>